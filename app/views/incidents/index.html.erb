<div class="container">
  <div class="my-3">
    <h1 class="d-flex justify-content-between">Todos las incidencias <%= link_to "Crear incidencia", new_incident_path, class:"btn btn-secondary my-auto" %></h1>
    <h4>Pendientes</h4>
    <div class="row row-cols-1 row-cols-md-2 g-4">
      <% @incidents.each do |incident| %>
        <% if IncidentUpdate.where(incident_id: incident.id).last %>
        <% else %>
          <div class="col">
            <div class="card shadow p-3 mb-5">
              <div class="card-body">
                <h5 class="card-title d-flex justify-content-between">
                  Número: <%= incident.id %>
                  <%= link_to "Ver incidencia", incident_path(incident), class:"btn btn-primary" %>
                </h5>
              </div>
              <ul class="list-group list-group-flush">
                <li class="list-group-item">Creada: <%= incident.created_at %></li>
                <li class="list-group-item">Propiedad ref.: <%= incident.property.property_reference %></li>
                <li class="list-group-item">Contacto que solicitó la incidencia: <%= incident.contact.full_name %></li>
                <li class="list-group-item">Creada por: <%= incident.user.first_name %></li>
                <li class="list-group-item">Tipo de incidente: <%= incident.kind %></li>
              </ul>
            </div>
          </div>
        <% end %>
      <% end %>
      <% @incidents.each do |incident| %>
        <% if IncidentUpdate.where(incident_id: incident.id).last %>
          <% if IncidentUpdate.where(incident_id: incident.id).last.incident_status == 'Pendiente'%>
            <div class="col">
              <div class="card shadow p-3 mb-5">
                <div class="card-body">
                  <h5 class="card-title d-flex justify-content-between">
                    Número: <%= incident.id %>
                    <%= link_to "Ver incidencia", incident_path(incident), class:"btn btn-primary" %>
                  </h5>
                </div>
                <ul class="list-group list-group-flush">
                  <li class="list-group-item">Creada: <%= incident.created_at %></li>
                  <li class="list-group-item">Propiedad ref.: <%= incident.property.property_reference %></li>
                  <li class="list-group-item">Contacto que solicitó la incidencia: <%= incident.contact.full_name %></li>
                  <li class="list-group-item">Creada por: <%= incident.user.first_name %></li>
                  <li class="list-group-item">Tipo de incidente: <%= incident.kind %></li>
                </ul>
              </div>
            </div>
          <% end %>
        <% end %>
      <% end %>
    </div>
    <hr>
    <h4>En curso</h4>
    <div class="row row-cols-1 row-cols-md-2 g-4">
      <% @incidents.each do |incident| %>
        <% if IncidentUpdate.where(incident_id: incident.id).last %>
          <% if IncidentUpdate.where(incident_id: incident.id).last.incident_status == 'En curso'%>
            <div class="col">
              <div class="card shadow p-3 mb-5">
                <div class="card-body">
                  <h5 class="card-title d-flex justify-content-between">
                    Número: <%= incident.id %>
                    <%= link_to "Ver incidencia", incident_path(incident), class:"btn btn-primary" %>
                  </h5>
                </div>
                <ul class="list-group list-group-flush">
                  <li class="list-group-item">Creada: <%= incident.created_at %></li>
                  <li class="list-group-item">Propiedad ref.: <%= incident.property.property_reference %></li>
                  <li class="list-group-item">Contacto que solicitó la incidencia: <%= incident.contact.full_name %></li>
                  <li class="list-group-item">Creada por: <%= incident.user.first_name %></li>
                  <li class="list-group-item">Tipo de incidente: <%= incident.kind %></li>
                </ul>
              </div>
            </div>
          <% end %>
        <% end %>
      <% end %>
    </div>
    <hr>
    <h4>Rechazadas</h4>
    <div class="row row-cols-1 row-cols-md-2 g-4">
      <% @incidents.each do |incident| %>
        <% if IncidentUpdate.where(incident_id: incident.id).last %>
          <% if IncidentUpdate.where(incident_id: incident.id).last.incident_status == 'Rechazada'%>
            <div class="col">
              <div class="card shadow p-3 mb-5">
                <div class="card-body">
                  <h5 class="card-title d-flex justify-content-between">
                    Número: <%= incident.id %>
                    <%= link_to "Ver incidencia", incident_path(incident), class:"btn btn-primary" %>
                  </h5>
                </div>
                <ul class="list-group list-group-flush">
                  <li class="list-group-item">Creada: <%= incident.created_at %></li>
                  <li class="list-group-item">Propiedad ref.: <%= incident.property.property_reference %></li>
                  <li class="list-group-item">Contacto que solicitó la incidencia: <%= incident.contact.full_name %></li>
                  <li class="list-group-item">Creada por: <%= incident.user.first_name %></li>
                  <li class="list-group-item">Tipo de incidente: <%= incident.kind %></li>
                </ul>
              </div>
            </div>
          <% end %>
        <% end %>
      <% end %>
    </div>
    <hr>
    <h4>Finalizadas</h4>
    <div class="row row-cols-1 row-cols-md-2 g-4">
      <% @incidents.each do |incident| %>
        <% if IncidentUpdate.where(incident_id: incident.id).last %>
          <% if IncidentUpdate.where(incident_id: incident.id).last.incident_status == 'Finalizada'%>
            <div class="col">
              <div class="card shadow p-3 mb-5">
                <div class="card-body">
                  <h5 class="card-title d-flex justify-content-between">
                    Número: <%= incident.id %>
                    <%= link_to "Ver incidencia", incident_path(incident), class:"btn btn-primary" %>
                  </h5>
                </div>
                <ul class="list-group list-group-flush">
                  <li class="list-group-item">Creada: <%= incident.created_at %></li>
                  <li class="list-group-item">Propiedad ref.: <%= incident.property.property_reference %></li>
                  <li class="list-group-item">Contacto que solicitó la incidencia: <%= incident.contact.full_name %></li>
                  <li class="list-group-item">Creada por: <%= incident.user.first_name %></li>
                  <li class="list-group-item">Tipo de incidente: <%= incident.kind %></li>
                </ul>
              </div>
            </div>
          <% end %>
        <% end %>
      <% end %>
    </div>
  </div>
  <hr>
  <%= link_to "Volver", :back, class: "btn btn-dark" %>
</div>




<% if false %>
<div class="container">
  <div class="my-3">
    <h1 class="d-flex justify-content-between">Todos las incidencias <%= link_to "Crear incidencia", new_incident_path, class:"btn btn-secondary my-auto" %></h1>
    <div class="row align-items-start">
      <div class="col">
        <h4>Pendientes</h4>
          <% @incidents.each do |incident| %>
          <% if IncidentUpdate.where(incident_id: incident.id).last %>
          <% else %>
            <p>Número: <%= incident.id %></p>
            <p>Creada: <%= incident.created_at %></p>
            <p>Propiedad ref.: <%= incident.property.property_reference %></p>
            <p>Contacto que solicitó la incidencia: <%= incident.contact.full_name %></p>
            <p>Creada por: <%= incident.user.first_name %></p>
            <p>Tipo de incidente: <%= incident.kind %></p>
            <p><%= link_to "Ver incidencia", incident_path(incident) %></p>
          <% end %>
        <% end %>
        <% @incidents.each do |incident| %>
          <% if IncidentUpdate.where(incident_id: incident.id).last %>
            <% if IncidentUpdate.where(incident_id: incident.id).last.incident_status == 'Pendiente'%>
              <p>Número: <%= incident.id %></p>
              <p>Creada: <%= incident.created_at %></p>
              <p>Propiedad ref.: <%= incident.property.property_reference %></p>
              <p>Contacto que solicitó la incidencia: <%= incident.contact.full_name %></p>
              <p>Creada por: <%= incident.user.first_name %></p>
              <p>Tipo de incidente: <%= incident.kind %></p>
              <p><%= link_to "Ver incidencia", incident_path(incident) %></p>
            <% end %>
          <% end %>
        <% end %>
      </div>
      <div class="col">
        <h4>En curso</h4>
        <% @incidents.each do |incident| %>
          <% if IncidentUpdate.where(incident_id: incident.id).last %>
            <% if IncidentUpdate.where(incident_id: incident.id).last.incident_status == 'En curso'%>
              <p>Número: <%= incident.id %></p>
              <p>Creada: <%= incident.created_at %></p>
              <p>Propiedad ref.: <%= incident.property.property_reference %></p>
              <p>Contacto que solicitó la incidencia: <%= incident.contact.full_name %></p>
              <p>Creada por: <%= incident.user.first_name %></p>
              <p>Tipo de incidente: <%= incident.kind %></p>
              <p><%= link_to "Ver incidencia", incident_path(incident) %></p>
            <% end %>
          <% end %>
        <% end %>
      </div>
      <div class="col">
        <h4>Rechazada</h4>
        <% @incidents.each do |incident| %>
          <% if IncidentUpdate.where(incident_id: incident.id).last %>
            <% if IncidentUpdate.where(incident_id: incident.id).last.incident_status == 'Rechazada'%>
            <p>Número: <%= incident.id %></p>
            <p>Creada: <%= incident.created_at %></p>
            <p>Propiedad ref.: <%= incident.property.property_reference %></p>
            <p>Contacto que solicitó la incidencia: <%= incident.contact.full_name %></p>
            <p>Creada por: <%= incident.user.first_name %></p>
            <p>Tipo de incidente: <%= incident.kind %></p>
            <p><%= link_to "Ver incidencia", incident_path(incident) %></p>
            <% end %>
          <% end %>
        <% end %>
      </div>
      <div class="col">
        <h4>Finalizada</h4>
        <% @incidents.each do |incident| %>
          <% if IncidentUpdate.where(incident_id: incident.id).last %>
            <% if IncidentUpdate.where(incident_id: incident.id).last.incident_status == 'Finalizada'%>
            <p>Número: <%= incident.id %></p>
            <p>Creada: <%= incident.created_at %></p>
            <p>Propiedad ref.: <%= incident.property.property_reference %></p>
            <p>Contacto que solicitó la incidencia: <%= incident.contact.full_name %></p>
            <p>Creada por: <%= incident.user.first_name %></p>
            <p>Tipo de incidente: <%= incident.kind %></p>
            <p><%= link_to "Ver incidencia", incident_path(incident) %></p>
            <% end %>
          <% end %>
        <% end %>
      </div>
    </div>
  </div>
  <hr>
  <%= link_to "Volver", :back, class: "btn btn-dark" %>
</div>
<% end %>
